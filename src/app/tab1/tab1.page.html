<ion-content [fullscreen]="true">
  <div
    class="bg-gradient-to-r from-indigo-500 to-purple-500 h-28 flex items-center text-white font-semibold"
  >
    <p class="text-3xl ml-4 font-mono">Participants</p>
  </div>
  <div class="-mt-10 p-4 space-y-4">
    <div
      class="rounded-xl bg-white dark:bg-neutral-900 shadow p-4 space-y-4 dark:text-slate-100"
    >
      <div class="flex gap-2 items-end">
        <ion-item class="flex-1">
          <ion-label position="stacked">Add user by email</ion-label>
          <ion-input
            placeholder="user@example.com"
            [(ngModel)]="userInviteEmail"
          ></ion-input>
        </ion-item>
        <ion-button
          (click)="addUserByEmail()"
          [disabled]="!userInviteEmail.trim() || userInviteStatus==='searching'"
          >Add</ion-button
        >
      </div>
      <div class="text-xs" *ngIf="userInviteStatus==='searching'">
        Looking up user...
      </div>
      <div class="text-xs text-green-600" *ngIf="userInviteStatus==='added'">
        User added.
      </div>
      <div class="text-xs text-amber-600" *ngIf="userInviteStatus==='notfound'">
        No registered user with that email.
      </div>
      <ion-list
        *ngIf="participants.length; else empty"
        class="dark:bg-transparent"
      >
        <ion-item *ngFor="let p of participants">
          <ion-label>
            <div class="flex items-center gap-2">
              <span>{{ p.name }}</span>
              <span
                *ngIf="isMe(p)"
                class="text-xs px-2 py-0.5 rounded-full bg-indigo-100 text-indigo-700 dark:bg-indigo-900/40 dark:text-indigo-300"
                >You</span
              >
            </div>
            <div
              class="text-xs text-gray-500 dark:text-gray-400"
              *ngIf="p.email"
            >
              {{ p.email }}
            </div>
          </ion-label>
          <ion-button
            fill="clear"
            color="danger"
            slot="end"
            (click)="remove(p.id)"
            *ngIf="!isMe(p)"
            >Remove</ion-button
          >
        </ion-item>
      </ion-list>
      <ng-template #empty>
        <div class="text-center text-sm text-gray-500 dark:text-gray-400 py-8">
          No participants yet. Add someone by email.
        </div>
      </ng-template>
    </div>

    <div
      class="rounded-xl bg-white dark:bg-neutral-900 shadow p-4 space-y-4 dark:text-slate-100"
    >
      <div class="text-base font-semibold">Groups</div>
      <div class="flex gap-2 items-end">
        <ion-item class="flex-1">
          <ion-label position="stacked">New group name</ion-label>
          <ion-input
            placeholder="e.g. Trip to Paris"
            [(ngModel)]="newGroupName"
          ></ion-input>
        </ion-item>
        <ion-button (click)="createGroup()" [disabled]="!newGroupName.trim()"
          >Create</ion-button
        >
      </div>

      <ion-item *ngIf="myGroups.length">
        <ion-label>My groups</ion-label>
        <ion-select
          [(ngModel)]="selectedGroupId"
          interface="popover"
          placeholder="Select a group"
          (ionChange)="onSelectGroup($event.detail.value)"
        >
          <ion-select-option *ngFor="let g of myGroups" [value]="g.id"
            >{{ g.name }}</ion-select-option
          >
        </ion-select>
      </ion-item>

      <div *ngIf="selectedGroupId">
        <div class="text-sm font-semibold mb-2">Members</div>
        <ion-list class="dark:bg-transparent">
          <ion-item *ngFor="let m of groupMembers()">
            <ion-label
              >{{ m.name }}
              <span
                class="text-xs text-gray-500 dark:text-gray-400"
                *ngIf="m.email"
                >({{ m.email }})</span
              ></ion-label
            >
            <ion-button
              fill="clear"
              color="danger"
              slot="end"
              (click)="removeMember(m.id)"
              >Remove</ion-button
            >
          </ion-item>
        </ion-list>

        <ion-button expand="block" color="medium" (click)="leaveGroup()"
          >Leave Group</ion-button
        >

        <div class="text-sm font-semibold mt-4">Invite by email</div>
        <div class="flex gap-2 items-end">
          <ion-item class="flex-1">
            <ion-label position="stacked">Email</ion-label>
            <ion-input
              placeholder="friend@example.com"
              [(ngModel)]="inviteEmail"
            ></ion-input>
          </ion-item>
          <ion-button (click)="invite()" [disabled]="!inviteEmail.trim()"
            >Send Invite</ion-button
          >
        </div>
      </div>

      <div
        *ngIf="pendingInvites.length"
        class="bg-amber-50 border border-amber-200 dark:bg-amber-900/30 dark:border-amber-300/30 rounded p-3 text-sm"
      >
        You have {{ pendingInvites.length }} pending invite(s). You can accept
        them in Summary.
      </div>
    </div>
  </div>
</ion-content>
