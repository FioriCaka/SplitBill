<ion-content [fullscreen]="true">
  <div
    class="bg-gradient-to-r from-indigo-500 to-purple-500 h-28 flex items-center text-white font-semibold"
  >
    <p class="text-3xl ml-4 font-mono">Participants</p>
  </div>
  <div class="-mt-10 p-4 space-y-4">
    <div
      class="rounded-xl bg-white dark:bg-neutral-900 shadow p-4 space-y-4 dark:text-slate-100"
    >
      <div class="flex gap-2 items-end">
        <ion-item class="flex-1">
          <ion-label position="stacked">Add user by email</ion-label>
          <ion-input
            placeholder="user@example.com"
            [(ngModel)]="userInviteEmail"
          ></ion-input>
        </ion-item>
        <ion-button
          (click)="addUserByEmail()"
          [disabled]="!userInviteEmail.trim() || userInviteStatus==='searching'"
          >Add</ion-button
        >
      </div>
      @if (userInviteStatus==='searching') {
      <div class="text-xs">Looking up user...</div>
      }
      @if (userInviteStatus==='added') {
      <div class="text-xs text-green-600">User added.</div>
      }
      @if (userInviteStatus==='notfound') {
      <div class="text-xs text-amber-600">
        No registered user with that email.
      </div>
      }
      @if (participants.length) {
      <ion-list class="dark:bg-transparent">
        @for (p of participants; track p.id) {
        <ion-item>
          <ion-label>
            <div class="flex items-center gap-2">
              <span>{{ p.name }}</span>
              @if (isMe(p)) {
              <span
                class="text-xs px-2 py-0.5 rounded-full bg-indigo-100 text-indigo-700 dark:bg-indigo-900/40 dark:text-indigo-300"
                >You</span
              >
              }
            </div>
            @if (p.email) {
            <div class="text-xs text-gray-500 dark:text-gray-400">
              {{ p.email }}
            </div>
            }
          </ion-label>
          @if (!isMe(p)) {
          <ion-button
            fill="clear"
            color="danger"
            slot="end"
            (click)="remove(p.id)"
            >Remove</ion-button
          >
          }
        </ion-item>
        }
      </ion-list>
      } @else {
      <div class="text-center text-sm text-gray-500 dark:text-gray-400 py-8">
        No participants yet. Add someone by email.
      </div>
      }
    </div>

    <div
      class="rounded-xl bg-white dark:bg-neutral-900 shadow p-4 space-y-4 dark:text-slate-100"
    >
      <div class="text-base font-semibold">Groups</div>
      <div class="flex gap-2 items-end">
        <ion-item class="flex-1">
          <ion-label position="stacked">New group name</ion-label>
          <ion-input
            placeholder="e.g. Trip to Paris"
            [(ngModel)]="newGroupName"
          ></ion-input>
        </ion-item>
        <ion-button (click)="createGroup()" [disabled]="!newGroupName.trim()"
          >Create</ion-button
        >
      </div>

      @if (myGroups.length) {
      <ion-item>
        <ion-label>My groups</ion-label>
        <ion-select
          [(ngModel)]="selectedGroupId"
          interface="popover"
          placeholder="Select a group"
          (ionChange)="onSelectGroup($any($event).detail.value)"
        >
          @for (g of myGroups; track g.id) {
          <ion-select-option [value]="g.id">{{ g.name }}</ion-select-option>
          }
        </ion-select>
      </ion-item>
      }

      @if (selectedGroupId) {
      <div>
        <div class="text-sm font-semibold mb-2">Members</div>
        <ion-list class="dark:bg-transparent">
          @for (m of groupMembers(); track m.id) {
          <ion-item>
            <ion-label
              >{{ m.name }}
              @if (m.email) {
              <span class="text-xs text-gray-500 dark:text-gray-400"
                >({{ m.email }})</span
              >
              }
            </ion-label>
            <ion-button
              fill="clear"
              color="danger"
              slot="end"
              (click)="removeMember(m.id)"
              >Remove</ion-button
            >
          </ion-item>
          }
        </ion-list>

        <ion-button expand="block" color="medium" (click)="leaveGroup()"
          >Leave Group</ion-button
        >

        <div class="text-sm font-semibold mt-4">Invite by email</div>
        <div class="flex gap-2 items-end">
          <ion-item class="flex-1">
            <ion-label position="stacked">Email</ion-label>
            <ion-input
              placeholder="friend@example.com"
              [(ngModel)]="inviteEmail"
            ></ion-input>
          </ion-item>
          <ion-button (click)="invite()" [disabled]="!inviteEmail.trim()"
            >Send Invite</ion-button
          >
        </div>
      </div>
      }

      @if (pendingInvites.length) {
      <div
        class="bg-amber-50 border border-amber-200 dark:bg-amber-900/30 dark:border-amber-300/30 rounded p-3 text-sm"
      >
        You have {{ pendingInvites.length }} pending invite(s). You can accept
        them in Summary.
      </div>
      }
    </div>
  </div>
</ion-content>
